<html>
<head>
  <title>Evernote Export</title>
  <basefont face="Segoe UI" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/308919 (es-ES, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: Segoe UI;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="521"/>

<div>
<span><div><div><span style="font-size: 14pt; font-weight: bold;">Observaciones</span></div><hr/><div>Todo el servidor fue configurado con PHP 7.1, por lo tanto cualquier paquete que requiera PHP deberá ser compatible con la versión 7.1</div><div><br/></div><div><span style="font-size: 14pt; font-weight: bold;">Datos de acceso al servidor</span></div><hr/><div><span style="font-weight: bold;">IP</span>: 192.168.52.4:8282/nextcloud</div><div><span style="font-weight: bold;">IP pública</span>: <a href="http://201.99.68.59/">http://201.99.68.59</a>/nextcloud</div><div><br/></div><div><span style="font-weight: bold;">Root</span></div><div>Usuario: root</div><div>Password: Corepro1</div><div><br/></div><div><span style="font-weight: bold;">Usuario</span>: coreprocesses</div><div>Password: Corepro1</div><div><br/></div><div><span style="font-weight: bold;">LDAP</span></div><div>Usuario: admin</div><div>Contraseña: CoreproTab1</div><div><br/></div><div><span style="font-weight: bold;">Admin GitLab</span></div><div>Usuario administrador: root</div><div>Contraseña:  Corepro1!TabVIM3x</div><div><br/></div><div><span style="font-weight: bold;">Admin Mattermost</span></div><div>Usuario administrador: root</div><div>Contraseña:  Corepro1!TabVIM3x</div><div><br/></div><div><span style="font-weight: bold;">Instancia MySQL</span></div><div>Usuario admin: root</div><div>Contraseña: Corepro1!TabVIM3x</div><div><br/></div><div><span style="font-weight: bold;">Base de datos Mattermost</span></div><div>BD: mattermost</div><div>Usuario: mmuser</div><div>Contraseña: mmuser-Corepro1</div><div><br/></div><div><span style="font-weight: bold;">NextCloud</span></div><div>Usuario administrador: admin</div><div>Contraseña: Corepro1</div><div><br/></div><div><span style="font-weight: bold;">GitLab</span>: 8089</div><div>Mattermost: 192.168.52.4:8065</div><div>Cambio PWD LDAP: 8090</div><div>Server name: coreprocesses</div><div><br/></div><div><span style="font-size: 14pt; font-weight: bold;">Instalación y actualización del servidor</span></div><hr/><div>Instalar Centos 7 con Particionado Automático (o particionado que requiera el ambiente que se desea configurar)  y la opción Servidor con GUI</div><div><br/></div><div>Para actualizar el sistema operativo favor de seguir la guía:</div><div><a href="https://www.itzgeek.com/how-tos/linux/centos-how-tos/how-to-update-centos-7-07-17-2-to-centos-7-3.html">https://www.itzgeek.com/how-tos/linux/centos-how-tos/how-to-update-centos-7-07-17-2-to-centos-7-3.html</a></div><div><br/></div><div><span style="font-size: 14pt; font-weight: bold;">Instalación de XRDP (el escritorio remoto)</span></div><hr/><div>Favor de seguir esta guía:</div><div><br/></div><div><a href="https://www.itzgeek.com/how-tos/linux/centos-how-tos/install-xrdp-on-centos-7-rhel-7.html">https://www.itzgeek.com/how-tos/linux/centos-how-tos/install-xrdp-on-centos-7-rhel-7.html</a></div><div><br/></div><div><br/></div><div><span style="font-size: 14pt; font-weight: bold;">Instalación de OpenLDAP (Directorio activo para configurar aplicaciones con una sola cuenta)</span></div><hr/><div>1.- Instalación de OpenLDAP: <a href="https://www.itzgeek.com/how-tos/linux/centos-how-tos/step-step-openldap-server-configuration-centos-7-rhel-7.html">https://www.itzgeek.com/how-tos/linux/centos-how-tos/step-step-openldap-server-configuration-centos-7-rhel-7.html</a></div><div>2.- Configuración de OpenLDAP</div><div>Setup LDAP admin password</div><div>slappasswd -h {SSHA} -s CoreproTab1</div><div>{SSHA}pyEMgaq4yfeLjfUJ4AqYe5F5A2sAbDu/</div><div><br/></div><div>Ruta de configuración de OpenLdap: </div><div>/etc/openldap/slapd.d/</div><div><br/></div><div><span style="font-weight: bold;">Archivo db.ldif</span></div><hr/><div>dn: olcDatabase={2}hdb,cn=config</div><div>changetype: modify</div><div>replace: olcSuffix</div><div>olcSuffix: dc=coreprocesses,dc=com</div><div><br/></div><div>dn: olcDatabase={2}hdb,cn=config</div><div>changetype: modify</div><div>replace: olcRootDN</div><div>olcRootDN: cn=admin,dc=coreprocesses,dc=com</div><div><br/></div><div>dn: olcDatabase={2}hdb,cn=config</div><div>changetype: modify</div><div>replace: olcRootPW</div><div>olcRootPW: {SSHA}pyEMgaq4yfeLjfUJ4AqYe5F5A2sAbDu/</div><hr/><div><br/></div><div><span style="font-weight: bold;">Archivo monitor.ldif</span></div><hr/><div>dn: olcDatabase={1}monitor,cn=config</div><div>changetype: modify</div><div>replace: olcAccess</div><div>olcAccess: {0}to * by dn.base=&quot;gidNumber=0+uidNumber=0,cn=peercred,cn=external, cn=auth&quot; read by dn.base=&quot;cn=admin,dc=coreprocesses,dc=com&quot; read by * none</div><hr/><div><br/></div><div><span style="font-weight: bold;">Archivo <span style="font-weight: bold;">base.ldif</span></span></div><hr/><div>dn: dc=coreprocesses,dc=com</div><div>dc: coreprocesses</div><div>objectClass: top</div><div>objectClass: domain</div><div><br/></div><div>dn: cn=admin ,dc=coreprocesses,dc=com</div><div>objectClass: organizationalRole</div><div>cn: admin</div><div>description: LDAP Manager</div><div><br/></div><div>dn: ou=People,dc=coreprocesses,dc=com</div><div>objectClass: organizationalUnit</div><div>ou: People</div><div><br/></div><div>dn: ou=Group,dc=coreprocesses,dc=com</div><div>objectClass: organizationalUnit</div><div>ou: Group</div><hr/><div><br/></div><div>Comando para importar el archivo base.ldif</div><div>ldapadd -x -W -D &quot;cn=admin,dc=coreprocesses,dc=com&quot; -f base.ldif</div><div><br/></div><div>Datos generales del LDAP:</div><ul><li><div>usuario administrador: admin</div></li><li><div>Contraseña: CoreproTab1</div></li><li><div>Cadena de conexión: cn=admin ,dc=coreprocesses,dc=com</div></li><li><div>Base DN: dc=coreprocesses, dc=com</div></li></ul><div><br/></div><div>Agregar atributo de correo electrónico:</div><div><br/></div><div>Al parecer con la edición directa del archivo </div><div>gedit /etc/openldap/schema/inetorgperson.ldif</div><div><br/></div><div>No funciona de manera permanente, por lo tanto me base en la modificación del esquema con este tutorial:</div><div><a href="http://directory.apache.org/apacheds/basic-ug/2.3.1-adding-schema-elements.html">http://directory.apache.org/apacheds/basic-ug/2.3.1-adding-schema-elements.html</a></div><div>Basicamente agregué como atributo mandatorio el mail en los esquemas person e inetOrgPerson</div><div><br/></div><div><span style="font-weight: bold;">Si por alguna circunstancia no funciona editar el archivo para poder agregar el correo, intentan solo de paso 1 al 3, no reiniciar el servicio de LDAP, primero crear el usuario con el correo y posteriormente reiniciar el servicio de LDAP.</span></div><div><br/></div><div>1.- Ejecutar comando: </div><div><br/></div><div>gedit /etc/openldap/schema/inetorgperson.ldif</div><div><br/></div><div>gedit /etc/openldap/schema/inetorgperson.schema</div><div><br/></div><div>2.- Pegar bloque al esquema</div><div><br/></div><div>olcAttributeTypes: ( 0.9.2342.19200300.100.1.3 NAME 'mail' 'rfc822Mailbox' DESC 'RFC1274: RFC822 Mailbox' EQUALITY caseIgnoreIA5Match SUBSTR caseIgnoreIA5SubstringsMatch SYNTAX 1.3.6.1.4.1.1466.115.121.1.26{256} )</div><div><br/></div><div>3.- Debe quedar así:</div><div><img src="Evernote.enex_files/Image.png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div><br/></div><div><br/></div><div>Reiniciar el servicio de ldap</div><div>systemctl stop slapd</div><div>systemctl start slapd</div><div>systemctl enable slapd</div><div>systemctl restart slapd</div><div><br/></div><div><br/></div><div>Instalar explorador de directorio activo (Apache Directory Studio)</div><div><br/></div><ol><li><div>Descargar el paquete e instalarlo: <a href="http://directory.apache.org/studio/download/download-linux.html">http://directory.apache.org/studio/download/download-linux.html</a></div></li><li><div>Crear LDAP Connection</div></li><li><div><img src="Evernote.enex_files/Image [1].png" type="image/png" data-filename="Image.png"/></div></li><li><div>Colocar el usuarios administrador</div></li><li><div><img src="Evernote.enex_files/Image [2].png" type="image/png" data-filename="Image.png"/></div></li><li><div>Crear el grupo Developers</div></li><ol><li><div><img src="Evernote.enex_files/Image [3].png" type="image/png" data-filename="Image.png"/></div></li><li><div><img src="Evernote.enex_files/Image [4].png" type="image/png" data-filename="Image.png"/></div></li><li><div><br/></div></li></ol><li><div>Crear usuarios (Favor de crearlos dentro de la Unidad Ogranización Developers)</div></li><ol><li><div>Crear usuario en LDAP con Apache Active Directory Studio: <a href="https://access.redhat.com/documentation/en-US/Fuse_MQ_Enterprise/7.1/html/Security_Guide/files/LDAP-AddUserEntries.html">https://access.redhat.com/documentation/en-US/Fuse_MQ_Enterprise/7.1/html/Security_Guide/files/LDAP-AddUserEntries.html</a>Los</div></li><li><div>Los usuarios deben tener llenadas las siguientes propiedades:</div></li><ol><li><div>cn: nombre completo</div></li><li><div>sn: apellidos</div></li><li><div>mail: correo de la empresa</div></li><li><div>uid: nombres usuario: lmartinez, bdominguez, etc</div></li><li><div>userPassword: password en texto plano</div></li></ol></ol></ol><div><br/></div></div><div>SUPER IMPORTANTE, por defecto la autenticación LDAP de Apache, viene deshabilitada por el Owncloud no se puede conectar con ldap, hacer lo siguiente:</div><div><br/></div><div>Verifica si la autenticación LDAP está habilitada</div><div>Comando: </div><div>getsebool -a|grep ldap </div><div><br/></div><div>Habilitar la autenticación LDAP</div><div>Comando: </div><div>setsebool httpd_can_connect_ldap 1</div><div><br/></div><div>Reiniciar Apache: apachectl restart</div><div><br/></div><div><span style="font-weight: bold;">CONFIGURACIÓN DE CONEXIÓN A LA AUTENTICACIÓN LDAP DE MANERA PERMANENTE</span></div><div><span style="font-weight: bold;">Verifica si la autenticación LDAP está habilitada </span></div><div>getsebool -a|grep ldap</div><div><span style="font-weight: bold;">Habilitar la autenticación LDAP por medio del comando setsebool.</span></div><div>El comando setsebool activa o desactiva Booleanos, la opción -P es para hacer los cambios persistentes (sin este parámetro, al reiniciar se perderá el cambio) y x es on o 1 para activar, u off o 0 para desactivar.</div><div>Para nuetro caso el comando queda con la siguiente sintaxis: </div><div>setsebool -P httpd_can_connect_ldap 1</div><div><span style="font-weight: bold;">Reiniciar el servicio </span></div><div>systemctl restart httpd</div><div><br/></div><div>Explicación del problema: </div><div><a href="https://help.nextcloud.com/t/ldap-mystery-cannot-even-test-base-dn/9372/7">https://help.nextcloud.com/t/ldap-mystery-cannot-even-test-base-dn/9372/7</a></div><div><a href="https://www.linuxquestions.org/questions/linux-server-73/ldap-authentication-error-%5Bcan%27t-contact-ldap-server%5D-from-apache-httpd-920907/">https://www.linuxquestions.org/questions/linux-server-73/ldap-authentication-error-%5Bcan%27t-contact-ldap-server%5D-from-apache-httpd-920907/</a></div><div><br/></div><div><br/></div><div><span style="font-size: 14pt; font-weight: bold;">Instalación de GitLab (IMPORTANTE, INSTALAR LA VERSIÓN COMMUNITY EDITION, sino algunas caracteristicas no funcionaran)</span></div><div><hr/></div><div><br/></div><div><ol><li><div>Guía de instalación: <a href="https://about.gitlab.com/installation/#centos-7">https://about.gitlab.com/installation/#centos-7</a></div></li><li><div>Actualización de comando para bajar el paquete:  curl <a href="https://packages.gitlab.com/install/repositories/gitlab/gitlab-ee/script.rpm.sh">https://packages.gitlab.com/install/repositories/gitlab/gitlab-ce/script.rpm.sh</a> | sudo bash</div></li><li><div>URL externa: sudo EXTERNAL_URL=&quot;<a href="http://gitlab.example.com/">http://</a><a href="http://gitlab.example.com/" style="color: rgb(0, 0, 238);">201.99.68.59</a>:8089&quot; yum install -y gitlab-ce</div></li><li><div>Autenticarse con root</div></li><ol><li><div>Usuario administrador: root</div></li><li><div>Contraseña:  Corepro1!TabVIM3x</div></li></ol><li><div>Agregar la configuración LDAP del archivo de configuración:</div></li><ol><li><div>Ejecutar el comando: sudo gedit /etc/gitlab/gitlab.rb</div></li><li><div>Buscar la sección de LDAP</div></li><ol><li><div>bind_dn: cn=admin ,dc=coreprocesses,dc=com</div></li><li><div>password: CoreproTab1</div></li><li><div>base: ou=developers,ou=Group,dc=coreprocesses,dc=com</div></li></ol><li><div><img src="Evernote.enex_files/Image [5].png" type="image/png" data-filename="Image.png"/></div></li></ol></ol><div><br/></div><div>########################################################################################################################</div><div>gitlab_rails['ldap_enabled'] = true</div><div><br/></div><div>###! **remember to close this block with 'EOS' below**</div><div>gitlab_rails['ldap_servers'] = YAML.load &lt;&lt;-'EOS'</div><div>   main: # 'main' is the GitLab 'provider ID' of this LDAP server</div><div>     label: 'Coreprocesses'</div><div>     host: 'localhost'</div><div>     port: 389</div><div>     uid: 'uid'</div><div>     bind_dn: 'cn=admin ,dc=coreprocesses,dc=com'</div><div>     password: 'CoreproTab1'</div><div>     encryption: 'plain' # &quot;start_tls&quot; or &quot;simple_tls&quot; or &quot;plain&quot;</div><div>     verify_certificates: false</div><div>     active_directory: true</div><div>     allow_username_or_email_login: false</div><div>#     lowercase_usernames: false</div><div>     block_auto_created_users: false</div><div>     base: 'dc=coreprocesses,dc=com'</div><div>#     user_filter: ''</div><div>#     ## EE only</div><div>#     group_base: ''</div><div>#     admin_group: ''</div><div>#     sync_ssh_keys: false</div><div>#</div><div>#   secondary: # 'secondary' is the GitLab 'provider ID' of second LDAP server</div><div>#     label: 'LDAP'</div><div>#     host: '_your_ldap_server'</div><div>#     port: 389</div><div>#     uid: 'sAMAccountName'</div><div>#     bind_dn: '_the_full_dn_of_the_user_you_will_bind_with'</div><div>#     password: '_the_password_of_the_bind_user'</div><div>#     encryption: 'plain' # &quot;start_tls&quot; or &quot;simple_tls&quot; or &quot;plain&quot;</div><div>#     verify_certificates: true</div><div>#     active_directory: true</div><div>#     allow_username_or_email_login: false</div><div>#     lowercase_usernames: false</div><div>#     block_auto_created_users: false</div><div>#     base: ''</div><div>#     user_filter: ''</div><div>#     ## EE only</div><div>#     group_base: ''</div><div>#     admin_group: ''</div><div>#     sync_ssh_keys: false</div><div>EOS</div><div>########################################################################################################################</div><ol><li><div>Reiniciar la configuración de GitLab</div></li><ol><li><div>Comando: gitlab-ctl reconfigure</div></li></ol><li><div>Reiniciar el sistema operativo:</div></li><ol><li><div>Comando: reboot</div></li></ol><li><div>Pruebas del directorio activo:</div></li><ol><li><div>Verificala existencia de un usuario: ldapsearch -D &quot;cn=admin ,dc=coreprocesses,dc=com&quot; -w CoreproTab1 -p 389 -h localhost -b &quot;ou=developers,ou=Group,dc=coreprocesses,dc=com&quot; -Z -s sub &quot;CN=Luis Marino Martínez Candelero&quot;</div></li></ol><li><div>Deshabilitar creación de cuentas</div></li><ol><li><div>Autenticarse con el usuario root:</div></li><li><div>Ir a: <a href="http://localhost:8181/admin/application_settings">http://localhost:8181/admin/application_settings</a></div></li><li><div>Deshabilitar la propiedad Sign-up enabled</div></li><li><div><img src="Evernote.enex_files/Image [6].png" type="image/png" data-filename="Image.png"/></div></li><li><div>Guardar los cambios</div></li></ol><li><div>Deshabilitar la creación de proyectos para los usuarios nuevos</div></li><ol><li><div>http://201.99.68.59:8089/admin/application_settings  buscar  Default projects limit = 0 </div></li></ol><li><div>Deshabilitar la creación de proyectos por default</div></li></ol><div><br/></div><div>Abrir el archivo de configuración</div><div><br/></div><div>Buscar la línea  (colocarla en false)</div><div><br/></div><div>gitlab_rails['gitlab_default_can_create_group'] = false</div><div><br/></div><div>Reiniciar GitLab</div><div><br/></div><div>gitlab-ctl reconfigure</div><div>sudo gitlab-ctl restart</div><div><br/></div><ol><li><div>Habilitar la configuración de cuenta de correos</div></li><ol><li><div>Ejecutar el comando: sudo gedit /etc/gitlab/gitlab.rb</div></li></ol></ol><div><br/></div><div><a href="mailto:bot@coreprocesses.com.mx" style="font-size: 11pt; font-family: Calibri, sans-serif;">bot@coreprocesses.com.mx</a></div><div>Configuración de correo para GitLab:</div><div>================================================================================</div><div>gitlab_rails['smtp_enable'] = true;</div><div>gitlab_rails['smtp_address'] = &quot;<a href="http://mail.coreprocesses.com.mx/">mail.coreprocesses.com.mx</a>&quot;</div><div>gitlab_rails['smtp_port'] = 587;</div><div>gitlab_rails['smtp_user_name'] = &quot;<a href="mailto:bot@coreprocesses.com.mx" style="font-size: 11pt; color: rgb(0, 0, 238); font-family: Calibri, sans-serif; text-decoration: underline;">bot@coreprocesses.com.mx</a>&quot;</div><div>gitlab_rails['smtp_password'] = &quot;<span style="font-size: 11pt; font-family: Calibri, sans-serif;">Corepro1</span>&quot;</div><div>gitlab_rails['smtp_domain'] = '<a href="http://coreprocesses.com.mx/">coreprocesses.com.mx</a>';</div><div>gitlab_rails['smtp_tls'] = false;</div><div>gitlab_rails['smtp_openssl_verify_mode'] = 'none'</div><div>gitlab_rails['smtp_enable_starttls_auto'] = false</div><div>gitlab_rails['smtp_ssl'] = false</div><div>gitlab_rails['smtp_force_ssl'] = false</div><div>================================================================================</div><div>Adicionalmente cambiar la configuración de:</div><div># gitlab_rails['gitlab_email_from'] = '<a href="mailto:example@example.com">example@example.com</a>'</div><div># gitlab_rails['gitlab_email_reply_to'] = '<a href="mailto:noreply@example.com">noreply@example.com</a>'</div><div>Por:</div><div>gitlab_rails['gitlab_email_from'] = '<a href="mailto:bot@coreprocesses.com.mx" style="font-size: 11pt; color: rgb(0, 0, 238); font-family: Calibri, sans-serif; text-decoration: underline;">bot@coreprocesses.com.mx</a>'</div><div>gitlab_rails['gitlab_email_reply_to'] = '<a href="mailto:bot@coreprocesses.com.mx" style="font-size: 11pt; color: rgb(0, 0, 238); font-family: Calibri, sans-serif; text-decoration: underline;">bot@coreprocesses.com.mx</a>'</div><div><br/></div><div>Ojo: según la cuenta que se haya creado (para efectos de este ejemplo. use mi cuenta personal.</div><div><br/></div><div>Ejecutar el comando de reconfiguración:</div><div>gitlab-ctl reconfigure</div><div><br/></div><div>Probar configuración de correo:</div><div>Ejecutar la consola de GitLab:  gitlab-rails console</div><div>Ejcutar comando de correo: Notify.test_email('<a href="mailto:destination_email@address.com">m</a>arino.martinez@outlook.com', 'Test GitLab', 'Test GitLab').deliver_now</div><div>Si el correo se envío debe salir algo así en pantalla:</div><div><br/></div><div><img src="Evernote.enex_files/Image [7].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div>De lo contrario revisar parametros de configuración.</div><div><br/></div><div>Configuración del repositorio para que los desarrolladores puedan hacer push en la master (por defecto solo los master pueden hacer push)</div><div>Dentro del proyecto: Settings-&gt;Repository-&gt; Protected Branches  -&gt; Allowed tu push -&gt; Developers + Masters</div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><font style="font-size: 14pt;"><span style="font-size: 14pt; font-weight: bold;">Instalación de Mattermost</span></font></div><div><hr/></div><div><br/></div><div>Procedimiento oficial: <a href="https://docs.mattermost.com/install/install-rhel-71.html">https://docs.mattermost.com/install/install-rhel-71.html</a></div><div><br/></div><div><span style="font-weight: bold;">Instalar MYSQL </span></div><div><br/></div><div>1 Descargar el repositorio:   wget <a href="http://dev.mysql.com/get/mysql57-community-release-el7-9.noarch.rpm">http://dev.mysql.com/get/mysql57-community-release-el7-9.noarch.rpm</a></div><div>Instalación MySQL</div><ul><li><div>Usuario admin: root</div></li><li><div>Contraseña: Corepro1!TabVIM3x</div></li></ul><div><br/></div><div><span style="font-weight: bold;">Datos generales de base de datos de mattermost</span></div><div><br/></div><div>BD: mattermost</div><div>Usuario: mmuser</div><div>Contraseña: mmuser-Corepro1</div><div><br/></div><div>Cambiar el password de Root:</div><div><br/></div><div>ALTER USER 'root'@'localhost' IDENTIFIED BY 'Corepro1!TabVIM3x';</div><div><br/></div><div>Crear el usuario de Mattermost</div><div><br/></div><div>create user 'mmuser'@'%' identified by 'mmuser-Corepro1';</div><div><br/></div><div>Crear la base de datos de Mattermost</div><div>create database mattermost;</div><div><br/></div><div>Obtener el último paquete de Mattermost</div><div><br/></div><div>wget <a href="https://releases.mattermost.com/4.8.0/mattermost-4.8.0-linux-amd64.tar.gz">https://releases.mattermost.com/4.8.0/mattermost-4.8.0-linux-amd64.tar.gz</a></div><div><br/></div><div>Directorios de instalación de Mattermost:</div><div><br/></div><div>/opt/mattermost/data</div><div><br/></div><div>Archivo de configuración de Mattermost</div><div><br/></div><div>/opt/mattermost/config/config.json</div><div><br/></div><div>Abrir con comando:</div><div><br/></div><div>gedit /opt/mattermost/config/config.json</div><div><br/></div><div>Archivo de configuración de servicio:</div><div>========================================================================================</div><div>[Unit]</div><div>Description=Mattermost</div><div>After=syslog.target network.target mysqld.service</div><div><br/></div><div>[Service]</div><div>Type=notify</div><div>WorkingDirectory=/opt/mattermost</div><div>User=mattermost</div><div>ExecStart=/opt/mattermost/bin/platform</div><div>PIDFile=/var/spool/mattermost/pid/master.pid</div><div>TimeoutStartSec=3600</div><div>LimitNOFILE=49152</div><div><br/></div><div>[Install]</div><div>WantedBy=multi-user.target</div><div><br/></div><div>========================================================================================</div><div>URL: localhost:8065</div><div>Datos de acceso root de Mattermost</div><div>Username:  root</div><div>Correo: <a href="mailto:luis.martinez@coreprocesses.com.mx">luis.martinez@coreprocesses.com.mx</a></div><div>Password: Corepro1!TabVIM3x</div><div><br/></div><div><span style="font-weight: bold;">Primeros pasos:</span></div><div>Configurar la URL Externa: <a href="http://localhost:8065/admin_console/general/configuration">http://localhost:8065/admin_console/general/configuration</a></div><div>Configurar LDAP:</div><div>Configurar: Correo:  <a href="http://localhost:8065/admin_console/notifications/notifications_email">http://localhost:8065/admin_console/notifications/notifications_email</a></div><div><br/></div><div>Crear El Team Name</div><div>Team Name: Coreprocesses</div><div><br/></div><div>En Team Settings habilitar que se puedan agregar los usuarios al team creado</div><div>Allow any user with an account on this server to join this team = Yes</div><div><br/></div><div>Deshabilitar la creación de equipos</div><div>http://192.168.52.132:8065/admin_console/general/users_and_teams</div><div>Enable Team Creation: False</div><div><br/></div><div>Reiniciar Mattermost</div><div>sudo systemctl restart mattermost</div><div><br/></div><div>Habilitar Link Preview</div><div><br/></div><div><br/></div><div><span style="font-weight: bold;">Integración con GITLAB</span></div><div>Al parecer LDAP de Mattermost solo está diponible en la versión Enterpise</div><div>Por lo tanto, Mattermost se configurará con autenticación de GitLab</div><div>Seguirt tutorial: <a href="https://docs.mattermost.com/deployment/sso-gitlab.html">https://docs.mattermost.com/deployment/sso-gitlab.html</a></div><div>1.- Agregar app en GitLab: <a href="http://localhost:8181/admin/applications/new">http://localhost:8181/admin/applications/new</a></div><div><br/></div><div>Con las URLs:</div><div><br/></div><div>http://201.99.68.59:8065/login/gitlab/complete</div><div>http://201.99.68.59:8065/signup/gitlab/complete</div><div><br/></div><div><br/></div><div>2.- Agregar la configuración en Mattermost (OJO hacerlo desde elarchivo de configuración, ya que luego desde la venta de configuración pueden existir errores):</div><div>Comando para abrir archivo de configuración:</div><div>gedit /opt/mattermost/config/config.json</div><div>Agregar la configuración:</div><div>&quot;GitLabSettings&quot;: {</div><div>        &quot;Enable&quot;: true,</div><div>        &quot;Secret&quot;: &quot;08723b1b63db91e488c201dc255017e739f708677711fd641f96c8a9b5c4b630&quot;, //Esto se obtiene de la aplicación configurada en GitLab</div><div>        &quot;Id&quot;: &quot;c09fadbda083bed3e733767bc359d3427d0ca8e94a2d86c143a2911fe72acde0&quot;, //Esto se obtiene de la aplicación configurada en GitLab</div><div>        &quot;Scope&quot;: &quot;&quot;,</div><div>        &quot;AuthEndpoint&quot;: &quot;http://192.168.52.132:8181/oauth/authorize&quot;, //La URL de GitLab</div><div>        &quot;TokenEndpoint&quot;: &quot;http://192.168.52.132:8181/oauth/token&quot;,  //La URL de GitLab</div><div>        &quot;UserApiEndpoint&quot;: &quot;http://192.168.52.132:8181/api/v4/user&quot;  //La URL de GitLab</div><div>    },</div><div><br/></div><div>Guardar los cambios</div><div>3.- Reiniciar Mattermost y GitLab</div><div>sudo systemctl restart mattermost</div><div>sudo gitlab-ctl reconfigure</div><div><br/></div><div>Configurar la URL de acceso en:</div><div>http://201.99.68.59:8065/admin_console/general/configuration</div><div><br/></div><div>Configurar la cuenta de correo en:</div><div>http://201.99.68.59:8065/admin_console/notifications/notifications_email</div><div><br/></div><div><span style="font-weight: bold;">Configurar el BOT de integración GitLab y Mattermost</span></div><div>Crear la integración en Mattermost</div><div>http://201.99.68.59:8065/coreprocesses/integrations</div><div>Title: Gitlab</div><div>Description: Gitlab Integration</div><div>Channel: Coreprocesses</div><div><br/></div><div>Habilitar la aplicación Mattemost en GitLab</div><div>http://201.99.68.59:8089/admin/application_settings/services</div><div>Agregar la URL del Webjook</div><div>http://201.99.68.59:8065/hooks/hytdmrgdc7ng5rarwi8uszg1dc (esta URL se genera en el paso previo, no siempre es la misma)</div><div>Username: hcbot</div><div><br/></div><div><span style="font-weight: bold;">Cambio de password de usuarios LDAP</span></div><div><br/></div><div><span style="font-weight: bold;">Instalar Apache</span></div><div>Seguir este tutorial:</div><div><a href="https://www.liquidweb.com/kb/how-to-install-apache-on-centos-7/">https://www.liquidweb.com/kb/how-to-install-apache-on-centos-7/</a></div><div><br/></div><div><span style="font-weight: bold;">Instalar PHP 7.1</span></div><div><br/></div><div>yum install epel-release</div><div>rpm -Uvh <a href="https://mirror.webtatic.com/yum/el7/webtatic-release.rpm">https://mirror.webtatic.com/yum/el7/webtatic-release.rpm</a></div><div>yum install mod_php71w php71w-common php71w-fpm php71w-opcache php71w-cli</div><div>php --version</div><div><br/></div><div><span style="font-weight: bold;">Instalación de paquetes adicionales de PHP para LDAP</span></div><div>yum install php71w-ldap php71w-intl</div><div><br/></div><div><span style="font-weight: bold;">Verifica si la autenticación LDAP está habilitada</span></div><div>Comando: </div><div>getsebool -a|grep ldap </div><div><br/></div><div>Habilitar la autenticación LDAP</div><div>Comando: </div><div>setsebool httpd_can_connect_ldap 1</div><div>systemctl restart httpd</div><div><br/></div><div><span style="font-weight: bold;">Colocar página para cambio de Password de LDAP</span></div><div><br/></div><div>Configurar HOST para la página de cambio de Password</div><div><br/></div><div><span style="font-weight: bold;">Abrir el archivo de configuración de Apache y Cambiar el Puerto del 80 al 8091</span></div><div>gedit /etc/httpd/conf/httpd.conf</div><div><br/></div><div>Ejecutar la instrucción, para dar permisos en el puerto:</div><div><br/></div><div>semanage port -a -t http_port_t -p tcp 8091</div><div><br/></div><div>Colocar el archivo de PHP que cambia el password en:</div><div><br/></div><div>/var/www/html</div><div><br/></div><div>Instrucción:</div><div><br/></div><div>gedit /var/www/html/ChangePasswordLDAP.php</div><div><br/></div><div>Por último validar que se pueda cambiar el password en la ruta pública</div><div><br/></div><div>http://201.99.68.59:8091/ChangePasswordLDAP.php</div><div><br/></div><div>Ruta de Acceso:</div><div><a href="http://localhost/ChangePasswordLDAP.php">http://localhost:8091/ChangePasswordLDAP.php</a></div><div><br/></div><div><a href="http://localhost/ChangePasswordLDAP.php">http://</a><a href="http://localhost/ChangePasswordLDAP.php" style="color: rgb(0, 0, 238); text-decoration: underline;">201.99.68.59</a>:8091/ChangePasswordLDAP.php</div><div><br/></div><div><span style="font-weight: bold;">Mostrar los nombres Reales o Nickname</span></div><div><span style="color: rgb(34, 34, 34); font-family: Helvetica, Arial, sans-serif; font-size: 15px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Currently, in Account Settings &gt; Display we have a setting that lets users control whether names in Mattermost are displayed as full names or usernames.</span></div><div><a href="http://201.99.68.59:8065/admin_console/general/users_and_teams">http://201.99.68.59:8065/admin_console/general/users_and_teams</a></div><div><br/></div><div><span style="font-size: 16pt; font-weight: bold;">Creación de cuentas LDAP</span></div><hr/><div><br/></div><div>Para la creación de cuentas utilizar Apache Active Directory </div><div><br/></div><div>Descargar el paquete e instalarlo: <a href="http://directory.apache.org/studio/download/download-linux.html">http://directory.apache.org/studio/download/download-linux.html</a></div><div><br/></div><div>Datos generales del LDAP:</div><div>usuario administrador: admin</div><div>Contraseña:</div><div>CoreproTab1</div><div>Cadena de conexión: cn=admin ,dc=coreprocesses,dc=com</div><div>Base DN: dc=coreprocesses, dc=com</div><div><br/></div><div>Crear usuarios (Favor de crearlos dentro de la Unidad Ogranización Developers)</div><div>Crear usuario en LDAP con Apache Active Directory Studio: <a href="https://access.redhat.com/documentation/en-US/Fuse_MQ_Enterprise/7.1/html/Security_Guide/files/LDAP-AddUserEntries.html">https://access.redhat.com/documentation/en-US/Fuse_MQ_Enterprise/7.1/html/Security_Guide/files/LDAP-AddUserEntries.html</a>Los</div><div>Los usuarios deben tener llenadas las siguientes propiedades:</div><div>cn: nombre completo</div><div>sn: apellidos</div><div>mail: correo de la empresa</div><div>uid: nombres usuario: lmartinez, bdominguez, etc</div><div>userPassword: password en texto plano y la contraseña por defecto: Corepro1</div><div><br/></div><div><span style="font-size: 16pt; font-weight: bold;">Problemas y soluciones comunes</span></div><hr/><div>Problema: El servidor de GitLab no funciona</div></div><div>Solución:</div><div>Ejecutar el siguiente comando:</div><div>gitlab-ctl reconfigure</div><div>sudo gitlab-ctl restart</div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div></span>
</div></body></html> 